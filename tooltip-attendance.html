<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <title>Tooltiper</title>

    <style>
        .applet-container {
            margin-top: 1rem;
            margin-left: 2rem;
            width: 90%;
        }

        #map {
            margin-top: .5rem;
            height: 25rem;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Home</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Maps
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="basic-map.html">Map 1 - Basic Map</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" aria-disabled="true">Disabled</a>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="applet-container">
        <h3>Attendance</h3>
        <p id="attendanceCount">NBSC Gym: 0</p>
        <button class="btn btn-primary" id="addAttendance">NBSC Gym</button>
        <div id="map"></div>
       
    </div>

    <script>
        class LeafletMap {
            constructor(containerId, center, zoom) {
                this.map = L.map(containerId).setView(center, zoom);
                this.initTileLayer();
                this.marker = null; // Initialize the marker property
            }

            initTileLayer() {
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(this.map);
            }

            addMarker(latitude, longitude, attendanceCount) {
                // Create message with attendance count using HTML
                const message = `
                    <div>
                        <strong>NBSC Gym</strong><br>
                        Attendance Count: <span id="attendanceCountPopup">${attendanceCount}</span>
                    </div>
                `;

                // Check if the marker already exists
                if (this.marker) {
                    // Update the popup content using inner HTML
                    this.marker.getPopup().setContent(message);
                    this.marker.openPopup(); // Open the popup explicitly
                } else {
                    // Create the marker if it doesn't exist
                    this.marker = L.marker([latitude, longitude]);
                    this.marker.bindPopup(message).openPopup(); // Open the popup immediately
                    this.marker.addTo(this.map); // Ensure the marker is added to the map
                }
            }
        }

        class AttendanceTracker {
            constructor(mapInstance) {
                this.attendanceCount = 0;
                this.map = mapInstance;
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('addAttendance').addEventListener('click', () => {
                    this.incrementCount();
                    this.map.addMarker(8.360080, 124.868887, this.attendanceCount); // Pass the attendance count
                });
            }

            incrementCount() {
                this.attendanceCount++;
                document.getElementById('attendanceCount').innerText = `Attendance Count: ${this.attendanceCount}`;
            }
        }

        const myMap = new LeafletMap('map', [8.360004, 124.868419], 16);
        myMap.addMarker(8.360080, 124.868887, 0); // Initialize with count 0
        const attendanceTracker = new AttendanceTracker(myMap);
    </script>
</body>
</html>
